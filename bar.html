<!DOCTYPE html>
<html>
  <head>
    <title>Bar Chart</title>
    <script type="text/javascript" src="lib/js/d3.js"></script>
    <script type="text/javascript" src="lib/js/jquery-min.js"></script>
   	<script type="text/javascript" src="lib/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
	<link rel="stylesheet" type="text/css" href="lib/fancybox/jquery.fancybox-1.3.4.css" media="screen" />
    <style type="text/css">

body {
  font: 10px sans-serif;
}

svg {
  shape-rendering: crispEdges;
}

    </style>
  </head>
  <body>
    <script type="text/javascript">
    $(document).ready(function(){
    	$("a#palette_launcher").fancybox();
    });
    
colors = [{"algorithm":"frequency","palette":[{"rgba":"22482B","frequency":112.63418820031686,"l":56.28140479067775,"a":-21.129380080731575,"b":11.385829685642348,"quality":0.22920005949909075,"query":"Stanford Cardinal"},{"rgba":"E5BD48","frequency":336.0635033786103,"l":88.96295609723083,"a":-3.9514353890379783,"b":40.7371423376377,"quality":0.31990908543943486,"query":"Cal Bears"},{"rgba":"846F45","frequency":1050.496902634026,"l":72.37039001953174,"a":-0.39863298556121907,"b":19.657266199781365,"quality":2.137663141488793,"query":"UCLA Bruins"},{"rgba":"0E5824","frequency":491.42303211646276,"l":58.79793111269046,"a":-40.12490918869436,"b":19.886208424873793,"quality":112.69987254385478,"query":"Oregon Ducks"}]},{"algorithm":"saturation","palette":[{"rgba":"CD0C00","frequency":21.81097131184915,"l":52.2819199557627,"a":63.350145751462804,"b":64.06443694453449,"quality":138.35024680765022,"query":"Stanford Cardinal"},{"rgba":"050153","frequency":139.21948065669918,"l":19.775669582081875,"a":52.72401879446395,"b":-69.99234171389458,"quality":113.99624898201185,"query":"Cal Bears"},{"rgba":"102373","frequency":25.905928340034325,"l":44.91448021595841,"a":11.748653426103369,"b":-43.5244898053928,"quality":119.55070195412905,"query":"UCLA Bruins"},{"rgba":"CAD21F","frequency":153.19580235768103,"l":90.12637405241814,"a":-18.469825062246464,"b":64.28550331082704,"quality":167.47634067846542,"query":"Oregon Ducks"}]},{"algorithm":"random","palette":[{"rgba":"D5D1D7","frequency":628.4637767521833,"l":92.80895876738721,"a":1.1799370280814707,"b":-1.0284121296711781,"quality":68.25845706671099,"query":"Stanford Cardinal"},{"rgba":"8A897F","frequency":687.6627893023972,"l":78.20615096604325,"a":-0.9164178692699096,"b":3.364398394967807,"quality":58.88384505885174,"query":"Cal Bears"},{"rgba":"102373","frequency":25.905928340034325,"l":44.91448021595841,"a":11.748653426103369,"b":-43.5244898053928,"quality":119.55070195412905,"query":"UCLA Bruins"},{"rgba":"0A0B09","frequency":263.77015985715707,"l":24.010527235493157,"a":-1.9500556766307593,"b":2.3661523003264886,"quality":51.381571217133164,"query":"Oregon Ducks"}]},{"algorithm":"distance","palette":[{"rgba":"CD0C00","frequency":21.81097131184915,"l":52.2819199557627,"a":63.350145751462804,"b":64.06443694453449,"quality":138.35024680765022,"query":"Stanford Cardinal"},{"rgba":"050153","frequency":139.21948065669918,"l":19.775669582081875,"a":52.72401879446395,"b":-69.99234171389458,"quality":113.99624898201185,"query":"Cal Bears"},{"rgba":"0D71B5","frequency":30.16038684948715,"l":67.9983232681885,"a":-18.805537135196243,"b":-30.050810488060623,"quality":0.028710590934502244,"query":"UCLA Bruins"},{"rgba":"0E5824","frequency":491.42303211646276,"l":58.79793111269046,"a":-40.12490918869436,"b":19.886208424873793,"quality":112.69987254385478,"query":"Oregon Ducks"}]}];
data = [{"query": "Stanford Cardinal", "wins": 20}, {"query": "Cal Bears", "wins": 14}, {"query": "UCLA Bruins", "wins": 10},
{"query": "Oregon Ducks", "wins": 21}];

var w = 430,
    h = 230,
    x = d3.scale.linear().domain([0, 30]).range([0, w]),
    y = d3.scale.ordinal().domain(d3.range(data.length)).rangeBands([0, h], .2);

vis = d3.select("body")
  .append("svg:svg")
    .attr("width", w + 200)
    .attr("height", h + 20)
  .append("svg:g")
    .attr("transform", "translate(100,0)");

var bars = vis.selectAll("g.bar")
    .data(data)
  .enter().append("svg:g")
    .attr("class", "bar")
    .attr("transform", function(d, i) { return "translate(0," + y(i) + ")"; });

bars.append("svg:rect")
    .attr("width", function(d,i) {return x(d.wins)})
    .attr("height", y.rangeBand());

bars.append("svg:text")
    .attr("x", x)
    .attr("y", y.rangeBand() / 2)
    .attr("dx", -6)
    .attr("dy", ".35em")
    .attr("fill", "white")
    .attr("text-anchor", "end")
    .text(x.tickFormat(100));

bars.append("svg:text")
    .attr("x", 0)
    .attr("y", y.rangeBand() / 2)
    .attr("dx", -6)
    .attr("dy", ".35em")
    .attr("text-anchor", "end")
    .text(function(d, i) { return d.query });

var rules = vis.selectAll("g.rule")
    .data(x.ticks(10))
  .enter().append("svg:g")
    .attr("class", "rule")
    .attr("transform", function(d) { return "translate(" + x(d) + ",0)"; });

rules.append("svg:line")
    .attr("y1", h)
    .attr("y2", h + 6)
    .attr("stroke", "black");

rules.append("svg:line")
    .attr("y1", 0)
    .attr("y2", h)
    .attr("stroke", "white")
    .attr("stroke-opacity", .3);

rules.append("svg:text")
    .attr("y", h + 9)
    .attr("dy", ".71em")
    .attr("text-anchor", "middle")
    .text(x.tickFormat(10));

vis.append("svg:line")
    .attr("y1", 0)
    .attr("y2", h)
    .attr("stroke", "black");

var chosen_palette = 0;

function redraw(){
	console.log("Originally palette= " + chosen_palette);
	vis.selectAll("g.bar")
      .data(data)
    .transition()
      .duration(1000)
      .attr("y", function(d) { return h - y(d.value) - .5; })
      .attr("fill", function(d, i) { console.log("chosen palette " + chosen_palette); return "#" + colors[chosen_palette].palette[i].rgba;})
      .attr("height", function(d) { return y(d.value); });
      
      chosen_palette = (chosen_palette + 1)%colors.length;
}
    </script>
    
    <a href="#" onclick="redraw()">Update</a>
    
    <a href="#palette-picker" id="palette_launcher">Show fancybox.</a>
    
    <div id="palette-picker">This will eventually be a palette picker.
    	</div>
  </body>
</html>